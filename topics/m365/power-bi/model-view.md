# 모델 보기

## 관계

여러 테이블을 어떤 기준으로 연결할지 정하는 규칙입니다.\
관계를 사용하면 여러 테이블들을 하나처럼 연결할 수 있습니다.

### 다 대 일(N:1)

하나의 항목이 여러 항목과 연결되는 관계입니다.

#### 다 대 일(N:1) 예시

사용자 테이블

| 사용자 ID |  이름  |
| :-------: | :----: |
|     1     | 최요찬 |
|     2     | 박가은 |

이메일 테이블

| 이메일 ID |              이름               | 사용자 ID |
| :-------: | :-----------------------------: | :-------: |
|     1     | `yochan.choi@businessemail.com` |     1     |
|     2     |    `heyyo@personalemail.com`    |     1     |
|     3     | `gaeun.park@businessemail.com`  |     2     |
|     4     |    `eunga@personalemail.com`    |     2     |

**한 명의 사용자**는 **여러 개의 이메일**을 소유한다.\
**하나의 이메일**은 **한 명의 사용자**에 의해 소유되어진다.

`사용자:이메일 = 1:N`

### 일 대 일(1:1)

두 테이블 모두 서로 각 키 값을 하나씩만 연결합니다.

#### 일 대 일(1:1) 예시

**한 명의 사용자**는 **하나의 프로필**을 가진다.\
**하나의 프로필**은 **한 명의 사용자**에 의해 소유된다.

사용자:프로필 = 1:1

### 일 대 다(1:N)

가장 일반적인 관계로, 하나의 항목이 여러 항목과 연결되는 관계입니다.
N:1을 반대로 연결한 것입니다.

### 다 대 다(N:M)

#### 다 대 다(N:M) 예시

**한 명의 학생**이 **여러 개의 수강 과목**을 듣는다.\
**하나의 수강 과목**은 **여러 명의 학생**에 의해 들어진다.

학생: 수강 과목 = N:M

## 교차 필터 방향

관계를 통해 한 테이블에서 선택한 값(필터)이 다른 테이블까지 전달되는 방향을 의미합니다.

### 단방향(Single)

한 방향으로만 필터가 전달됩니다.

#### 단방향 예시

매장 테이블 (stores)

| store_id | city |
| -------- | ---- |
| 1        | 서울 |
| 2        | 부산 |

매출 테이블 (sales)

| sale_id | store_id | amount |
| ------- | -------- | ------ |
| 101     | 1        | 10000  |
| 102     | 1        | 20000  |
| 103     | 2        | 15000  |

stores → sales

city = "서울"을 선택하면  
store_id = 1만 남고  
해당 store_id의 매출만 계산됩니다.

즉, 매장 필터가 매출 테이블로만 전달됩니다.

#### 왜 단일이 권장될까?

- 모델이 단순해집니다.
- 계산 결과가 예측 가능합니다.
- 성능이 안정적입니다.
- 필터 흐름이 명확합니다.
- 스타 스키마 구조에 적합합니다.

실무에서는 대부분 단일을 사용합니다.

### 양방향(Both)

양쪽 테이블이 서로를 필터링합니다.

#### 양방향 예시

매장 테이블 (stores)

| store_id | city |
| -------- | ---- |
| 1        | 서울 |
| 2        | 부산 |

매출 테이블 (sales)

| sale_id | store_id | amount |
| ------- | -------- | ------ |
| 101     | 1        | 10000  |
| 102     | 1        | 20000  |
| 103     | 2        | 15000  |

stores ↔ sales

매출 테이블에서 특정 매출만 남기면  
해당 매출과 연결된 매장만 남게 됩니다.

즉,
매출이 매장을 다시 필터링할 수 있습니다.

#### 양방향이 문제가 되는 경우

1. 필터가 예상치 못한 방향으로 전달될 수 있습니다.
2. 여러 테이블이 연결되어 있을 경우
   필터가 순환(circular)하며 계산이 꼬일 수 있습니다.
3. 성능이 느려질 수 있습니다.
4. 결과가 직관과 다르게 나올 수 있습니다.

특히 다대다(N:M) 관계에서 양방향은
복잡도를 크게 증가시킵니다.

#### 그렇다면 양방향은 언제 사용하나요?

- 브리지 테이블(중간 연결 테이블)을 사용하는 경우
- 복잡한 다대다 분석이 필요한 경우
- 특정 차원이 다른 차원을 필터링해야 하는 특수 분석
- 고급 모델링 상황

초보자 단계에서는 거의 사용하지 않습니다.

## 정리

| 상황                 | 권장 설정       |
| -------------------- | --------------- |
| 일반적인 1:N 관계    | 단일            |
| 대부분의 리포트 모델 | 단일            |
| 다대다 + 복잡한 분석 | 신중하게 양방향 |
| 특별한 분석 요구사항 | 필요 시 양방향  |

### 해당 지식을 알아야 하는 이유

Power BI에서 그래프를 만들면, 그 그래프는 항상 어떤 "항목별로" 숫자를 보여줍니다.

예를 들어 "~별"이라는 말이 붙는 순간,
이미 어떤 항목을 기준으로 나누고 있다는 뜻입니다.

기준이 되는 항목은 차트마다 다릅니다.

- 막대그래프에서는 "축"이 기준
- 테이블에서는 "계산하지 않는 열"이 기준
- 매트릭스에서는 "행/열에 들어간 항목"이 기준

이 때 관계는 서로 다른 테이블 사이 데이터가 같은 항목임을 연결해 주는 규칙을 만들고, 교차 필터 방향은 그 연결이 '어느 방향으로 적용될지'를 정합니다.
