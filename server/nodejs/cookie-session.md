# ì¿ í‚¤ì™€ ì„¸ì…˜

## ì¿ í‚¤ì™€ ì„¸ì…˜ ì°¨ì´

ì¿ í‚¤ëŠ” ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ì˜ ì¿ í‚¤ë°ì´í„°ë¥¼ ë¹„ìš°ê±°ë‚˜ ê¸ˆì§€í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ê³„ì†í•´ì„œ ìœ ì§€ê°€ ë©ë‹ˆë‹¤.\
ì„¸ì…˜ ì €ì¥ì†Œì˜ ê²½ìš° ë°©ë¬¸ìê°€ ì ‘ì†í•´ ì„¸ì…˜ì´ ë°œìƒí•˜ê³  ì§€ì •ëœ ì‹œê°„ì´ ì§€ë‚˜ ì„¸ì…˜ì´ ì¢…ë£Œë˜ë©´ ì €ì¥ì†Œì˜ ë‚´ìš©ë„ ì‚¬ë¼ì§€ê²Œ ëœë‹¤ëŠ” ì ì´ ì°¨ì´ì ì…ë‹ˆë‹¤.

## ì¿ í‚¤

í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ì„œë²„ëŠ” ëˆ„ê°€ ìš”ì²­ì„ ë³´ë‚´ëŠ”ì§€ ëª¨ë¦…ë‹ˆë‹¤.\
ê·¸ë ‡ê²Œ ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì‚¬ìš©ìê°€ ëˆ„êµ¬ì¸ì§€ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.\
ì‚¬ìš©ìê°€ ëˆ„êµ¬ì¸ì§€ ê¸°ì–µí•˜ê¸° ìœ„í•´ ì„œë²„ëŠ” ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µì„ í•  ë•Œ ì¿ í‚¤ë¼ëŠ” ê²ƒì„ ê°™ì´ ë³´ëƒ…ë‹ˆë‹¤.

ì¿ í‚¤ëŠ” ìœ íš¨ ê¸°ê°„ì´ ìˆìœ¼ë©° `name=zimablue14`ì™€ ê°™ì´ ë‹¨ìˆœí•œ â€˜í‚¤-ê°’â€™ì˜ ìŒì…ë‹ˆë‹¤.\
ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ë¡œ ì¿ í‚¤ê°€ ë³´ë‚´ë©´, ì›¹ ë¸Œë¼ìš°ì €ëŠ” ì¿ í‚¤ë¥¼ ì €ì¥í•´ë’€ë‹¤ê°€ ë‹¤ìŒì— ìš”ì²­í•  ë•Œë§ˆë‹¤ ì¿ í‚¤ë¥¼ ë™ë´‰í•´ì„œ ë³´ëƒ…ë‹ˆë‹¤.\
ì„œë²„ëŠ” ìš”ì²­ì— ë“¤ì–´ ìˆëŠ” ì¿ í‚¤ë¥¼ ì½ì–´ì„œ ì‚¬ìš©ìê°€ ëˆ„êµ¬ì¸ì§€ êµ¬ë¶„í•©ë‹ˆë‹¤.

ì¦‰, ì„œë²„ëŠ” ë¯¸ë¦¬ í´ë¼ì´ì–¸íŠ¸ì— ìš”ì²­ìë¥¼ ì¶”ì •í•  ë§Œí•œ ì •ë³´ë¥¼ ì¿ í‚¤ë¡œ ë§Œë“¤ì–´ ë³´ë‚´ê³  í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì¿ í‚¤ë¥¼ ë°›ì•„ ìš”ì²­ìë¥¼ íŒŒì•…í•©ë‹ˆë‹¤.
ì¿ í‚¤ëŠ” ìš”ì²­ì˜ í—¤ë”(Cookie)ì— ë‹´ê²¨ ì „ì†¡ë˜ë©°, ë¸Œë¼ìš°ì €ëŠ” ì‘ë‹µì˜ í—¤ë”(Set-Cookie)ì— ë”°ë¼ ì¿ í‚¤ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.

![ì¿ í‚¤](./img//cookie.png)

ì¿ í‚¤ëŠ” `name=zimablue;year=1994`ì²˜ëŸ¼ ë¬¸ìì—´ í˜•ì‹ìœ¼ë¡œ ì¡´ì¬í•©ë‹ˆë‹¤.\
ì¿ í‚¤ ê°„ì—ëŠ” ì„¸ë¯¸ì½œë¡ (`;`)ì„ ë„£ì–´ ê°ê°ì„ êµ¬ë¶„í•©ë‹ˆë‹¤.

## Node.jsì—ì„œ http ëª¨ë“ˆì„ ì‚¬ìš©í•  ë•Œ cookie ë‹¤ë£¨ê¸°

ìš°ì„  í—¤ë”ì˜ ì´ë¦„ì„ `Set-Cookie`ë¡œ ì •ì˜í•©ë‹ˆë‹¤.\
`Set-Cookie`ëŠ” ì¿ í‚¤ë¥¼ ì„¤ì •í•˜ëŠ” ì˜ˆì•½ëª…ì…ë‹ˆë‹¤.

```tsx
res.setHeader('Set-cookie', 'loggedIn=true');
```

ì¿ í‚¤ ì½ì„ ë•Œë„ ì—¬ëŸ¬ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ê°’ì„ ë°œë¼ëƒ…ë‹ˆë‹¤.

```tsx
req.get('Cookie').split(';')[0].trim().split('=')[1];
```

### ì „ì²´ ì‚¬ìš© ì˜ˆì‹œ

```tsx
// ì¿ í‚¤ ë¬¸ìì—´ì„ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
const parseCookies = (cookie = '') =>
  cookie
    .split(';')
    .map(v => v.split('='))
    .reduce((acc, [k, v]) => {
        acc[k.trim()] = decodeURIComponent(v);
        return acc;
    }, {});


http
  .createServer(async (req, res) => {

    // ë¨¼ì € ì €ì¥ë˜ì–´ìˆëŠ” ì¿ í‚¤ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ ê²€ì‚¬
    const cookies = parseCookies(req.headers.cookie); // ë³€í™˜ -> { mycookie: 'test' }

    // formì—ì„œ actionì´ /Loginìœ¼ë¡œ, submití•˜ë©´ ë°œë™
    if (req.url.startsWith('/login')) {

        const { query } = url.parse(req.url); // urlì„ ê°ì²´ë¡œ ë§Œë“¤ì–´ queryí‚¤ë§Œ ë¹¼ì˜´
        const { name } = qs.parse(query); // queryí‚¤ì˜ ê°’ì¸ ë¬¸ìì—´ì„ ë˜ ê°ì²´í™”í•´ì„œ nameí‚¤ë§Œ ë¹¼ì˜´. ì´ ê°’ì€ ì¿ í‚¤ì— ì €ì¥ë êº¼ì„

        const expires = new Date();
        expires.setMinutes(expires.getMinutes() + 5);

        res.writeHead(302, {
          Location: '/',
          'Set-Cookie': `name=${encodeURIComponent(name)}; Expires=${expires.toGMTString()}; HttpOnly; Path=/`,
        });
        res.end();


    } else if (cookies.name) {
      // nameì´ë¼ëŠ” ì¿ í‚¤ê°€ ìˆëŠ” ê²½ìš°, ë¡œê·¸ì¸ ëœ ê²½ìš°
    }
  }
```

## Expressì˜ cookie-parser ì‚¬ìš©

`cookie-parser`ëŠ” ìš”ì²­ê³¼ í•¨ê»˜ ë“¤ì–´ì˜¨ ì¿ í‚¤ë¥¼ í•´ì„í•˜ì—¬ ê³§ë°”ë¡œ `req.cookies`ê°ì²´ë¡œ ë§Œë“­ë‹ˆë‹¤.\
ìœ íš¨ ê¸°ê°„ì´ ì§€ë‚œ ì¿ í‚¤ëŠ” ì•Œì•„ì„œ ê±¸ëŸ¬ëƒ…ë‹ˆë‹¤.

```tsx
const express = require('express');
const path = require('path');
const morgan = require('morgan');
const cookieParser = require('cookie-parser');

const app = express();

app.set('port', process.env.PORT || 3000);

app.use(cookieParser()); // getìš”ì²­ì´ ì˜¤ë©´ urië³€ìˆ˜ë“¤ì´ íŒŒì‹±ë˜ì–´ req.cookiesê°ì²´ì— ì €ì¥

app.get('/', (req, res) => {
   // ì¿ í‚¤ ì½ê¸°
   if (req.cookies) {
     console.log(req.cookies) // { mycookie: 'test'}

   } else { // í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥ëœ ì¿ í‚¤ê°€ ì—†ë‹¤ë©´
     // ì¿ í‚¤ ì“°ê¸°
     // 'Set-Cookie': `name=${encodeURIComponent(name)}; Expires=${expires.toGMTString()}; HttpOnly; Path=/`,
     res.cookie('name', encodeURIComponent(name), {
        expires: new Date(),
        httpOnly: true,
        path: '/',
     })
   }
   res.send('Hello, index');
});

app.listen(app.get('port'), () => {
  console.log(app.get('port'), 'ë²ˆ í¬íŠ¸ì—ì„œ ëŒ€ê¸° ì¤‘');
});
```

## ì°¸ê³  ìë£Œ

- [Node.js êµê³¼ì„œ ê°œì • 3íŒ](https://thebook.io/080334/)
- [[EXPRESS] ğŸ“š bodyParser / cookieParser ë¯¸ë“¤ì›¨ì–´ ğŸ’¯ ì‚¬ìš©ë²• ì •ë¦¬](https://inpa.tistory.com/entry/EXPRESS-%F0%9F%93%9A-bodyParser-cookieParser-%EB%AF%B8%EB%93%A4%EC%9B%A8%EC%96%B4)
